module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=13)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.extend},,function(t,e){t.exports=flarum.core.compat["components/DiscussionList"]},function(t,e){t.exports=flarum.core.compat["components/IndexPage"]},function(t,e,r){t.exports=r(10)},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},function(t,e){t.exports=flarum.core.compat["states/DiscussionListState"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},,function(t,e,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=r(11),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},function(t,e){!function(e){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof t,f=e.regeneratorRuntime;if(f)c&&(t.exports=f);else{(f=e.regeneratorRuntime=c?t.exports:{}).wrap=w;var l="suspendedStart",p="suspendedYield",h="executing",d="completed",m={},y={};y[a]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(C([])));g&&g!==n&&o.call(g,a)&&(y=g);var b=k.prototype=j.prototype=Object.create(y);O.prototype=b.constructor=k,k.constructor=O,k[u]=O.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===O||"GeneratorFunction"===(e.displayName||e.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,u in t||(t[u]="GeneratorFunction")),t.prototype=Object.create(b),t},f.awrap=function(t){return{__await:t}},P(L.prototype),L.prototype[s]=function(){return this},f.AsyncIterator=L,f.async=function(t,e,r,n){var o=new L(w(t,e,r,n));return f.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},P(b),b[u]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},f.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},f.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return s.type="throw",s.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),m}}}function w(t,e,r,n){var o=e&&e.prototype instanceof j?e:j,i=Object.create(o.prototype),a=new T(n||[]);return i._invoke=function(t,e,r){var n=l;return function(o,i){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw i;return U()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var u=x(t,e,r);if("normal"===u.type){if(n=r.done?d:p,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(t,r,a),i}function x(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function j(){}function O(){}function k(){}function P(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function L(t){var e;this._invoke=function(r,n){function i(){return new Promise(function(e,i){!function e(r,n,i,a){var s=x(t[r],t,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(c).then(function(t){u.value=t,i(u)},function(t){return e("throw",t,i,a)})}a(s.arg)}(r,n,e,i)})}return e=e?e.then(i,i):i()}}function _(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,_(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=x(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,m;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,m):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function C(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return i.next=i}}return{next:U}}function U(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},,function(t,e,r){"use strict";r.r(e);var n=r(5),o=r.n(n);function i(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}var a=r(1),s=r(0),u=r.n(s),c=r(7),f=r.n(c),l=r(3),p=r.n(l),h=r(6),d=r.n(h),y=r(4),v=r.n(y),g=r(8),b=r.n(g);u.a.initializers.add("kyrne-websocket",function(){var t=new Promise(function(t,e){"connected"!==u.a.socketStatus&&$.getScript("//cdnjs.cloudflare.com/ajax/libs/pusher/5.1.1/pusher.min.js",function(){if(!u.a.session.user&&u.a.forum.attribute("websocketAuthOnly"))return!1;u.a.forum.attribute("debug")&&(Pusher.logToConsole=!0);var e="1"===u.a.forum.attribute("websocketReverseProxy")?443:u.a.forum.attribute("websocketPort")||2083,r=new Pusher(u.a.forum.attribute("websocketKey"),{authEndpoint:u.a.forum.attribute("apiUrl")+"/websocket/auth",cluster:null,wsHost:u.a.forum.attribute("websocketHost")||window.location.hostname,wsPort:u.a.forum.attribute("websocketPort")||2083,wssPort:e,enableStats:!1,encrypted:u.a.forum.attribute("websocketSecure"),auth:{headers:{"X-CSRF-Token":u.a.session.csrfToken}},enabledTransports:["ws","flash"],disabledTransports:["xhr_polling","xhr_streaming","sockjs"]});return r.connection.bind("state_change",function(t){return u.a.socketStatus=t.current}),t({main:r.subscribe("public"),user:u.a.session.user?r.subscribe("private-user"+u.a.session.user.id()):null})})});u.a.pusher=t,u.a.pushedUpdates=[],Object(a.extend)(p.a.prototype,"oncreate",function(t){var e=this;u.a.pusher.then(function(t){Object.keys(t).map(function(r){null!==t[r]&&t[r].bind("newPost",function(t){var r=u.a.discussions.getParams();if(!r.q&&!r.sort&&!r.filter){if(r.tags){var n=u.a.store.getBy("tags","slug",r.tags);if(-1===t.tagIds.indexOf(Number(n.id())))return}var o=String(t.discussionId);u.a.current.get("discussion")&&o===u.a.current.get("discussion").id()||-1!==u.a.pushedUpdates.indexOf(o)||u.a.request({method:"GET",url:u.a.forum.attribute("apiUrl")+"/discussions/"+o+"?include=user"}).then(function(t){if(u.a.forum.attribute("websocketAutoUpdate")){var r=u.a.store.pushPayload(t);e.attrs.state.removeDiscussion(r),e.attrs.state.addDiscussion(r),document.hasFocus()||(u.a.setTitleCount(u.a.titleCount+1),$(window).one("focus",function(){return u.a.setTitleCount(0)}))}else u.a.pushedUpdates.push(t),u.a.current.matches(v.a)&&u.a.setTitleCount(u.a.pushedUpdates.length),m.redraw()})}})})})}),Object(a.extend)(p.a.prototype,"onremove",function(t){u.a.pusher.then(function(t){Object.keys(t).map(function(e){null!==t[e]&&t[e].unbind("newPost")})})}),Object(a.extend)(p.a.prototype,"view",function(t){var e=this;if(u.a.pushedUpdates){var r=u.a.pushedUpdates.length,n=!1;u.a.pushedUpdates.map(function(t){u.a.current.data.user&&t.included[0].id==u.a.current.data.user.id()&&(n=!0)});var a=function(){var n,a;t.children.unshift(b.a.component({className:"Button Button--block DiscussionList-update",onclick:(n=o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingUpdated=!0,t.next=3,u.a.pushedUpdates.map(function(t){var r=u.a.store.pushPayload(t);e.attrs.state.removeDiscussion(r),e.attrs.state.addDiscussion(r)});case 3:u.a.pushedUpdates=[],u.a.setTitleCount(0),m.redraw(),e.loadingUpdated=!1;case 7:case"end":return t.stop()}},t,this)}),a=function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function s(t){i(a,r,o,s,u,"next",t)}function u(t){i(a,r,o,s,u,"throw",t)}s(void 0)})},function(){return a.apply(this,arguments)}),loading:e.loadingUpdated},u.a.translator.trans("kyrne-websocket.forum.discussion_list.show_updates_text",{count:r})))};u.a.current.data.user?n&&a():r&&a()}}),Object(a.extend)(f.a.prototype,"parseResults",function(){u.a.pushedUpdates=[],u.a.current.matches(v.a)&&u.a.setTitleCount(0),m.redraw()}),Object(a.extend)(d.a.prototype,"oncreate",function(){var t=this;u.a.pusher.then(function(e){Object.keys(e).map(function(r){null!==e[r]&&e[r].bind("newPost",function(e){var r=String(e.discussionId);if(t.discussion&&t.discussion.id()===r&&t.stream){var n=t.discussion.commentCount();u.a.store.find("discussions",t.discussion.id()).then(function(){t.stream.update().then(function(){document.hasFocus()||(u.a.setTitleCount(Math.max(0,t.discussion.commentCount()-n)),$(window).one("focus",function(){return u.a.setTitleCount(0)})),m.redraw()})})}})})})}),Object(a.extend)(d.a.prototype,"onremove",function(){u.a.pusher.then(function(t){Object.keys(t).map(function(e){null!==t[e]&&t[e].unbind("newPost")})})}),Object(a.extend)(v.a.prototype,"actionItems",function(t){t.remove("refresh")}),u.a.pusher.then(function(t){t.user&&t.user.bind("notification",function(){u.a.session.user.pushAttributes({unreadNotificationCount:u.a.session.user.unreadNotificationCount()+1,newNotificationCount:u.a.session.user.newNotificationCount()+1}),u.a.notifications.clear(),m.redraw()})})})}]);
//# sourceMappingURL=forum.js.map